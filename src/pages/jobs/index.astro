---
import JobsDirectorySection from '../../components/JobsDirectorySection.astro';
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Jobs Directory" description="Browse approved job stories with filters.">
  <section class="page-hero">
    <p><strong>Jobs Directory</strong></p>
    <h1>Browse real experiences, not vague titles.</h1>
    <p>Filter by industry, work mode, or keyword to quickly shortlist relevant roles.</p>
  </section>

  <section class="panel collections" aria-label="Curated collections">
    <h2>Curated collections</h2>
    <p>Jump into focused role sets if you are exploring a specific path.</p>
    <div class="collections-grid">
      <a href="/jobs?industry=Healthcare&seniority=Entry">
        <h3>Healthcare starter paths</h3>
        <p>Entry roles with practical day-to-day details and student advice.</p>
      </a>
      <a href="/jobs?workMode=remote&experienceBand=0-2">
        <h3>Remote-friendly entry roles</h3>
        <p>Stories from roles with remote options and lower experience barriers.</p>
      </a>
      <a href="/jobs?industry=Software&seniority=Mid">
        <h3>Mid-career software tracks</h3>
        <p>See how responsibilities and tradeoffs evolve beyond junior roles.</p>
      </a>
    </div>
  </section>

  <JobsDirectorySection search={Astro.url.search} server:defer>
    <div slot="fallback" class="stack" aria-live="polite" aria-busy="true">
      <section class="panel filters-skeleton">
        <div class="skeleton-chip"></div>
        <div class="skeleton-chip"></div>
        <div class="skeleton-chip"></div>
        <div class="skeleton-chip"></div>
      </section>
      <p class="result-count">Loading jobs...</p>
      <section class="job-grid">
        {
          Array.from({ length: 8 }).map(() => (
            <article class="panel card-skeleton">
              <div class="skeleton-line short" />
              <div class="skeleton-line long" />
              <div class="skeleton-line medium" />
            </article>
          ))
        }
      </section>
    </div>
  </JobsDirectorySection>
</Layout>

<style>
  .collections {
    margin-bottom: 1rem;
  }

  .collections h2 {
    margin: 0;
  }

  .collections p {
    color: var(--ink-soft);
  }

  .collections-grid {
    display: grid;
    gap: 0.75rem;
    grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
  }

  .collections-grid a {
    text-decoration: none;
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 0.75rem;
    background: #fff;
  }

  .collections-grid h3 {
    margin: 0;
    color: var(--ink-strong);
    font-size: 1rem;
  }

  .collections-grid p {
    margin: 0.35rem 0 0;
    color: var(--ink-soft);
    font-size: 0.92rem;
  }

  .filters-skeleton {
    display: flex;
    flex-wrap: wrap;
    gap: 0.7rem;
  }

  .skeleton-chip,
  .skeleton-line {
    border-radius: 999px;
    background: var(--skeleton-shimmer);
    background-size: 180% 100%;
    animation: shimmer 1.2s ease-in-out infinite;
  }

  .skeleton-chip {
    width: 150px;
    height: 2rem;
  }

  .card-skeleton {
    display: grid;
    gap: 0.55rem;
  }

  .skeleton-line {
    height: 1rem;
  }

  .skeleton-line.short {
    width: 35%;
  }

  .skeleton-line.medium {
    width: 65%;
  }

  .skeleton-line.long {
    width: 90%;
  }

  @keyframes shimmer {
    0% {
      background-position: 100% 0;
    }
    100% {
      background-position: -100% 0;
    }
  }

  .result-count {
    color: var(--ink-soft);
  }

  .job-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 0.9rem;
  }
</style>
