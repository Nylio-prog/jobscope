---
import Layout from '../../layouts/Layout.astro';
import { getApprovedJobProfileBySlug } from '../../lib/job-profiles-repository';

const slug = Astro.params.slug ?? '';
const job = await getApprovedJobProfileBySlug(slug);

if (!job) {
  Astro.response.status = 404;
}
---

{
  job ? (
    <Layout title={job.roleTitle} description={job.dayToDay}>
      <section class="page-hero">
        <p>
          <strong>{job.industry}</strong>
        </p>
        <h1>{job.roleTitle}</h1>
        <p>
          {job.location} · {job.workMode} · {job.seniority} · {job.yearsExperience} years experience
        </p>
        <div class="cta-row">
          <a class="btn btn-secondary" href="/jobs">
            Back to directory
          </a>
          <a class="btn btn-primary" href="/share">
            Share your experience
          </a>
        </div>
      </section>

      <section class="detail-grid">
        <article class="panel">
          <h2>Day to day</h2>
          <p>{job.dayToDay}</p>
        </article>
        <article class="panel">
          <h2>Best parts</h2>
          <p>{job.bestParts}</p>
        </article>
        <article class="panel">
          <h2>Hardest parts</h2>
          <p>{job.hardestParts}</p>
        </article>
        <article class="panel">
          <h2>Advice for students</h2>
          <p>{job.recommendationToStudents}</p>
        </article>
        <article class="panel">
          <h2>Practical details</h2>
          <ul>
            <li>
              <strong>Salary range:</strong> {job.salaryRange ?? 'Not provided'}
            </li>
            <li>
              <strong>Education path:</strong> {job.educationPath ?? 'Not provided'}
            </li>
            <li>
              <strong>Contributor type:</strong> {job.submitterType}
            </li>
          </ul>
        </article>
        <article class="panel">
          <h2>Tools used</h2>
          <ul>
            {job.toolsUsed.map((tool) => (
              <li>{tool}</li>
            ))}
          </ul>
        </article>
      </section>
    </Layout>
  ) : (
    <Layout title="Job Not Found" description="The requested job profile was not found.">
      <section class="page-hero">
        <p>
          <strong>404</strong>
        </p>
        <h1>Job profile not found.</h1>
        <p>The link may be outdated or the profile may have been removed.</p>
        <a class="btn btn-secondary" href="/jobs">
          Back to jobs
        </a>
      </section>
    </Layout>
  )
}

<style>
  .detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 0.9rem;
  }

  .detail-grid h2 {
    margin-top: 0;
  }

  .detail-grid p,
  .detail-grid li {
    color: var(--ink-soft);
  }
</style>
